# Домашнее задание к занятию «Микросервисы: принципы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- маршрутизация запросов к нужному сервису на основе конфигурации,
- возможность проверки аутентификационной информации в запросах,
- обеспечение терминации HTTPS.

Обоснуйте свой выбор.

---

Рассмотрим популярные open-source решения: [Kong](https://konghq.com/products/api-gateway-platform), [Tyk](https://tyk.io/) и [KrakenD](https://www.krakend.io/).  

| Решение | Маршрутизация   | Аутентификация   | Терминация HTTPS      |
|---------|-----------------|------------------|-----------------------|
| Kong    | Есть            | Есть             | Есть                  |
| Tyk     | Есть            | Есть             | Есть                  |
| KrakenD | Есть            | Есть             | Есть                  |

Все решения удовлетворяют необходимым требованиям.

Согласно [тестам производительности](https://www.krakend.io/docs/benchmarks/api-gateway-benchmark/), KrakenD работает быстрее Kong и Tyk.

Community-версия KrakenD не имеет ограничений, в то время как бесплатная версия Kong ограничена 1 млн запросов в месяц, а Tyk - 250 вызовов API объёмом не более 2.5 ГБ.

**Решение:** предпочительней в качестве API Gateway выбрать KrakenD.

## Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- поддержка кластеризации для обеспечения надёжности,
- хранение сообщений на диске в процессе доставки,
- высокая скорость работы,
- поддержка различных форматов сообщений,
- разделение прав доступа к различным потокам сообщений,
- простота эксплуатации.

Обоснуйте свой выбор.

---

Рассмотрим популярные решения [Apache Kafka](https://kafka.apache.org), [RabbitMQ](https://www.rabbitmq.com/) и [Amazon SQS](https://aws.amazon.com/sqs/).

| Решение      | Кластеризация | Хранение сообщений на диске  | Высокая скорость работы | Поддержка различных форматов сообщений | Разделение прав доступа | Простота эксплуатации |
|--------------|---------------|------------------------------|-------------------------|----------------------------------------|-------------------------|-----------------------|
| Apache Kafka | Да            | Да                           | Очень высокая           | Да                                     | Да                      | Нет                   |
| RabbitMQ     | Да            | Да                           | Достаточно высокая      | Да                                     | Да                      | Да                    |
| Amazon SQS   | Да            | Да                           | Высокая                 | Да                                     | Да                      | Да                    |

Apache Kafka имеет высокую скорость работы, но сложен в эксплуатации и имеет проблемы с обработкой битых сообщений.

Брокера RabbitMQ удовлетворяет необходимым требованиям, удобен для разработчиков, имеет удобную панель администрирования и большое количество тонких настроек. 

Amazon SQS предоставляет такие дополнительные функции как шифрование всех сообщений и автоматические бэкапы, однако
устанавливает лимиты на количество отправленных сообщений, их размер и пропускную способность очереди FIFO. Также выбор
Amazon SQS будет являться жёсткой привязкой к вендору и вызовет проблемы при необходимости смены брокера.

**Решение:** наиболее подходящим решением для брокера сообщений является RabbitMQ. 